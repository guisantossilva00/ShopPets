<!-- sldsValidatorIgnore -->
<!-- sldsValidatorIgnore -->
<template> 
    <div class ="space distance">
        <div class="smallSpace" style="text-align: left">
            <span style="font-size: 17px">{orderName}</span>
        </div>
        <div class="space" style="text-align: right">
            <!-- sldsValidatorIgnoreNextLine -->
            <!--<button value="Rascunho" onclick={saveAll} class="slds-button slds-button_brand">Salvar como rascunho</button>-->
            <button value="Finalizado" onclick={saveAll} class="slds-button slds-button_brand">Finalizar pedido</button>
            <button onclick={deleteOrder} class="slds-button slds-button_neutral">Excluir</button>
            <button onclick={componentExit} class="slds-button slds-button_neutral">Cancelar</button>
        </div>
    </div>
    <div style="background-color: whitesmoke; padding: 12px">
        <div class = "space topic"> 
            <span>Informações do Pedido:</span>
        </div>
        
        <div class="slds-form-element space distance" aria-hidden="false">
            <div class="slds-form-element__control">

                <div class = "smallSpace">
                    <div style="padding: 5px" class="slds-grid slds-gutters ">
                        <div class="slds-col" style="margin-left: -1%">
                            <span><b>Cliente:</b> {account.SAPCodeTxt__c} - {account.Name__c}</span>
                        </div>
                        <div style="margin-left: 30%" class="slds-col">
                            <span><b>Valor total:</b> R$ <lightning-formatted-number value={totalValue} format-style="decimal" maximum-fraction-digits="2"></lightning-formatted-number></span>
                        </div>
                    </div>
                </div>
                <span><b>Equipe de venda:</b> </span>
                <div class="slds-select_container smallSpace"> 
                    <select onchange={setTeam} class="slds-select">
                        <option value="Nenhum">Selecione uma opção</option>
                        <template for:each={teams} for:item="team">
                            <option key={team.Id} value={team.Id}>{team.Name}</option>
                        </template>
                    </select>
                </div>
                <span><b>Endereço de entrega:</b></span>
                <div class="slds-select_container smallSpace"> 
                    <select onchange={setAddress} class="slds-select" title="Endereço">
                        <option value="Nenhum">Selecione uma opção</option>
                        <template for:each={addresses} for:item="address">
                            <option key={address.Id} value={address.Id}>{account.SAPCodeTxt__c} - {account.Name__c} — {address.City}/{address.State}/{address.Country}</option>
                        </template>
                    </select>
                </div>
                <span><b>Incoterm:</b></span>
                <div class="slds-select_container smallSpace"> 
                    <select onchange={setIncoterm} class="slds-select" title="Opções de entrega">
                            <option value="Nenhum">Selecione uma opção</option>
                            <template for:each={incoterm} for:item="option">
                                <option key={option} value={option}>{option}</option>
                            </template>
                    </select>
                </div>
                <span><b>Condição de pagamento:</b> </span>
                <div class="slds-select_container smallSpace"> 
                    <select onchange={setCondition} class="slds-select">
                        <option value="Nenhum">Selecione uma opção</option>
                        <template for:each={conditions} for:item="condition">
                            <option key={condition.Name} value={condition.Id}>{condition.Name} — {condition.SAPCodeTxt__c}</option>
                        </template>
                    </select>
                </div>
                <span><b>Área de venda:</b> </span>
                <div class="slds-select_container smallSpace"> 
                    <select onchange={setArea} class="slds-select">
                        <option value="Nenhum">Selecione uma opção</option>
                        <template for:each={areas} for:item="area">
                            <option key={area.Id} value={area.Id}>{area.Name}</option>
                        </template>
                    </select>
                </div>
                <div class = "smallSpace"> 
                    <span><b>Observações sobre o pedido:</b> </span>
                    <div style="position: sticky;">
                        <lightning-textarea onchange={setOrderObservation} maxlength=1000 class = "inputAdjust" type="text" placeholder="Digite a observação do pedido."></lightning-textarea>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <div class ="space distance">
        <div class="smallSpace" style="text-align: right">
            <button onclick={openModal} class="slds-button slds-button_neutral">Adicionar produto</button>
        </div> 

        <template if:true={isModalOpen}>
            <section style="width: 100%;  height: 100%;" role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal_small slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                  <header class="slds-modal__header">
                    <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Adicionar produtos</h2>
                  </header>

                  <div style="display: flex; justify-content: center" class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <table style="max-height: 80%;" aria-multiselectable="true" class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered" >
                        <thead class="slds-line-height_reset">
                            <tr class="slds-line-height_reset">
                                <th style="background-color: whitesmoke;"></th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Produto">Código do produto</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Produto">Nome do produto</div>
                                </th>   
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={products} for:item="productModal" for:index="indexModal">
                                <tr key={productModal}>
                                    <td style="background-color: whitesmoke;">
                                        <div style="text-align: center;">
                                            <lightning-input onchange={markedProduct}  id={indexModal} name={indexModal} title="Selecionar" type="checkbox" enabled></lightning-input>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="slds-truncate cell-font">{productModal.SAPCodeTxt__c}</div>
                                    </td>
                                    <td>
                                        <div style="height:1rem;width:30rem" title={productModal.Name} class="slds-truncate cell-font">{productModal.Name}</div>
                                    </td>
                                </tr>   
                            </template>
                        </tbody>
                    </table>
                    <div style="margin-left: 15px" class="space distance">
                        <div>
                            <table>
                                <template for:each={productsWithSalesAction} for:item="productWithAction" for:index="index">
                                    <tr key={productWithAction}>
                                        <template if:true={productWithAction}>
                                            <td>
                                                <lightning-icon
                                                        class = "icon"  
                                                        icon-name="utility:quote"
                                                        size="small"
                                                        alternative-text="Ação de venda associada"
                                                        title="Ação de venda associada"
                                                        variant="success">
                                                </lightning-icon>
                                            </td>
                                        </template>    
                                        <template if:false={productWithAction}>
                                            <td>
                                                <!--
                                                <lightning-icon
                                                        class = "icon"  
                                                        icon-name="utility:quote"
                                                        size="small">
                                                </lightning-icon>
                                                -->
                                                <lightning-icon
                                                class = "no-icon"  
                                                icon-name=""
                                                size="small">
                                                </lightning-icon>
                                            </td>
                                        </template>                                          
                                    </tr>
                                </template>
                            </table>
                        </div>
                    </div>
                  </div>
                  
                  <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={closeModal} title="Cancelar">Cancelar</button>
                    <button class="slds-button slds-button_brand" onclick={addItens} title="Adicionar">Adicionar</button>
                  </footer>

                </div>
              </section>
              <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
    </div>

    <div style="background-color: whitesmoke; padding: 1px">
        <template if:false={showTable}>
            <div class = "space topic"> 
                <span>Nenhum item do pedido foi adicionado.</span>
            </div>
        </template>
        <template if:true={showTable}>
            <div class = "space topic"> 
                <span><b>Itens do pedido</b></span>
            </div>  
            <div class="slds-grid slds-gutters space distance">
                <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered" >
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Produto">Produto</div>
                            </th>

                            <th class="" scope="col">
                                <div class="slds-truncate" title="Quantidade">Quantidade</div>
                            </th>

                            <th class="" scope="col">
                                <div class="slds-truncate" title="Desconto">Desconto</div>
                            </th>

                            <th class="" scope="col">
                                <div class="slds-truncate" title="Data da remessa">Data da remessa</div>
                            </th>

                            <th class="" scope="col">
                                <div class="slds-truncate" title="Preço de contrato">Preço de tabela</div>
                            </th>

                            <th class="" scope="col">
                                <div class="slds-truncate" title="Valor unitário">Valor unitário</div>
                            </th>
                            
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Valor total">Valor total</div>
                            </th>
                            <th style="background-color: whitesmoke;"></th>
                        </tr>
                        </thead>
                        <tbody>
                            <template for:each={orderItens} for:item="orderItem" for:index="index">
                                <tr style="text-align: center;" key={orderItem} class="slds-hint-parent">
                                    <td>
                                        <div key={orderItem} style="height:1rem;width:5rem">
                                            <div style="font-size: 11px" title={orderItem.Name} class="slds-truncate">{orderItem.Name}</div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="basic-unit-label">{orderItem.BasicUnitTxt__c}</span>
                                        <lightning-input id={orderItem.Id} required="" name={orderItem.Product2Id} onchange={valueCalculation} value={orderItem.Quantity} class="middle-center" max-length=3 title="Quantidade"  type="number" placeholder="0" format-style="number"></lightning-input>
                                    </td>
                                    <td>
                                        <lightning-input id={orderItem.Id} onchange={valueCalculation}  name={orderItem.Product2Id} value={orderItem.DiscountNmb__c}  title="Desconto" placeholder="0,00" step="0.01" max-length=4 type="number"></lightning-input>
                                        <div style="font-size: 12px; text-align: center;">0,00% - 5,00%</div>
                                    </td>
                                    <td>
                                        <lightning-input id={orderItem.Id} value={orderItem.DateShipmentDte__c} required="" onchange={todayDateAdjust} name={orderItem.Product2Id} class="middle-center" placeholder="DD/MM/AAAA" date-style="short" title="Data da remessa" type="date"></lightning-input>
                                    </td>
                                    <td>
                                        <span id={orderItem.Id} data-id={orderItem.Product2Id} title="Preço de tabela">{orderItem.valueTable}</span>
                                    </td>
                                    <td>
                                        <lightning-input id={orderItem.Id} required="" onblur={valueCalculation} name={orderItem.Product2Id} class="middle-center"  max-length=6 title="Valor unitário" value={orderItem.UnitPrice} step="0.01" placeholder="00,00" type="number"></lightning-input>
                                    </td>
                                    <td>
                                        <lightning-formatted-number id={orderItem.Id} title="Valor total" value={orderItem.TotalNmb__c} format-style="decimal" maximum-fraction-digits="2"></lightning-formatted-number>
                                    </td>
                                    <td style="background-color: whitesmoke;"> 
                                        <div class = "cell-font">
                                            <lightning-icon id={orderItem.Id} onclick={deleteSelectedItem} name={index} title="Remover item do pedido." style="width: 0px; margin-right: 10px" size="small" key={index} icon-name="utility:delete"></lightning-icon>
                                        </div>
                                    </td>
                                </tr> 
                            </template>
                        </tbody>
                    </table>
                </div>
            </template>
        </div>

</template>