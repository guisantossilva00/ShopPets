public class OrderPDFController {
    
    public boolean hasError {get; private set;}
    public String errorMessage {get; private set;}
    
    public Account client {get; private set;}
    public String clientDocument {get; private set;}
    
    public Order order {get; private set;}
    public String orderSalesType {get; private set;}
    public String formattedDateTime {get;private set;}
    public String formattedTotal {get;private set;} 
    
    public List<OrderItem> orderItens {get;private set;}
    
    public ContactPointAddress address {get; private set;}
    public SalesTeam__c salesTeam {get;private set;}
    
    
    public orderPDFController(ApexPages.StandardController controller){
        this.hasError = false;
        this.errorMessage = '';
        String orderId = ApexPages.CurrentPage().getparameters().get('id');
        
        if(orderInitValidate(orderId)){
            return;
        }
        
        clientInit();
        addressInit();
        
        if(sellerSalesTeamInitValidate()){
            return;
        }
    }
    
    public String getSalesTypeLabel(String value){
        List<Schema.PicklistEntry> picklistEntries = Schema.SObjectType.Order.fields.SalesType__c.getPicklistValues();
        for(Schema.PicklistEntry item :picklistEntries){
            
            if(item.getValue() == value){
                System.debug('item.getLabel(): '+item.getLabel());
                return item.getLabel();
            } 
        }
        System.debug('ENTER');
        
        return '';
    }

    @testvisible
    private boolean orderInitValidate(String orderId){
        this.order = [SELECT Id, SalesTeamLkp__c, ObservationLtxt__c , SalesTeamLkp__r.Name, DeliveryOption__c, TotalAmount, CreatedDate, SalesType__c, Name, AccountId, 
                      paymentCondition__c, OrderNumberTxt__c, paymentCondition__r.name, Status, ContactPointAddressLkp__c FROM Order WHERE id =: orderId];
        System.debug('ENTER');
        
        if(this.order.Status != 'Finalizado' && this.order.Status != 'Cancelado'&& this.order.Status != 'Devolvido'){
            this.errorMessage = 'Não é possível gerar o PDF! O pedido não foi finalizado.';
            this.hasError = true;
            return true;
        }
        
        if(this.order.SalesType__c != null && this.order.SalesType__c != ''){
            this.orderSalesType = getSalesTypeLabel(this.order.SalesType__c);
        }
        
        this.formattedDateTime = this.order.CreatedDate.format();
        
        if(this.order.TotalAmount == null || this.order.TotalAmount <= 0){
            this.errorMessage = 'Não é possível gerar o PDF, o pedido não possui um valor total.';
            this.hasError = true;
            return true;
        }
        this.formattedTotal = ''+this.order.TotalAmount.setScale(2);
        
        if(this.order.DeliveryOption__c == null || this.order.DeliveryOption__c == ''){
            this.errorMessage = 'Não é possível gerar o PDF, o pedido não possui modalidade de entrega.';
            this.hasError = true;
            return true;
        }
        
        if(this.order.AccountId == null){
            this.errorMessage = 'Não é possível gerar o PDF, o pedido não contém nenhum cliente.';
            this.hasError = true;
            return true;
        }
        
        if(this.order.paymentCondition__c == null){
            this.errorMessage = 'Não é possível gerar o PDF, o pedido não contém nenhuma condição de pagamento.';
            this.hasError = true;
            return true;
        }
        
        if(this.order.ContactPointAddressLkp__c == null){
            this.errorMessage = 'Não é possível gerar o PDF, o pedido não contém nenhum endereço.';
            this.hasError = true;
            return true;
        }
        
        if(this.order.SalesTeamLkp__c == null){
            this.errorMessage = 'Não é possível gerar o PDF, o pedido não contém nenhuma equipe de vendas.';
            this.hasError = true;
            return true;
        }
        
        return false;
    }
    @testvisible
    private void clientInit(){
        this.client = [SELECT id, Name__c, CPFTxt__c, StateRegistrationTxt__c, CNPJTxt__c, SAPCodeTxt__c FROM Account WHERE Id =: this.order.AccountId];
        
        if(this.client.CNPJTxt__c != '' && this.client.CNPJTxt__c != null){
            this.clientDocument = this.client.CNPJTxt__c;
        }
        
        if(this.client.CPFTxt__c != '' && this.client.CPFTxt__c != null){
            this.clientDocument = client.CPFTxt__c;   
        }
    }
    @testvisible
    private void addressInit(){
        this.address = [SELECT id, Street, City, PostalCode, Country , State 
                        FROM ContactPointAddress WHERE id =: this.order.ContactPointAddressLkp__c AND AddressType = 'Shipping' AND IsPrimary = true AND IsDefault = true];
    }
    
    private boolean sellerSalesTeamInitValidate(){
        this.salesTeam = [SELECT id, RepresentativeLkp__c, RepresentativeLkp__r.Name, Name FROM SalesTeam__c WHERE id =: this.order.SalesTeamLkp__c];
        System.debug('ENTER');
        
        if(salesTeam.RepresentativeLkp__c == null){
            this.errorMessage = 'Não é possível gerar o PDF, não existe nenhum vendedor da equipe de vendas associado ao pedido.';
            this.hasError = true;
            return true;
        }
        
        return false;
    }
        public static void testMock(){
       Integer i = 0;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
                    i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
                    i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
        i++;
    }
}